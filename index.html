<!DOCTYPE html>
<!--  automatic dark mode :) -->
<html data-color-mode="auto" data-dark-theme="dark" data-light-theme="light" lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <link href="https://unpkg.com/@primer/css@^19.0.0/dist/primer.css" rel="stylesheet"/>
    <title>SteamDepotDownloaderGUI</title>
</head>
<body>
<script>
    function submitForm() {
        const os = require('os');
        const fs = require('fs');
        const https = require('https');
        const path = require('path').dirname(__filename);

        //TODO: make this download the latest DepotDownloader zip and make it compatible on Linux, macOS and windows
        //document.getElementById("download").disabled = true;
        let spawn = require("child_process").spawn;

        let username = document.forms["theform"]["username"].value;
        let password = document.forms["theform"]["password"].value;
        let appid = document.forms["theform"]["appid"].value;
        let depotid = document.forms["theform"]["depotid"].value;
        let manifestid = document.forms["theform"]["manifestid"].value;
        console.debug(
            "DEBUG INFO\n"
            + "Username: " + username
            + "\nPassword: no"
            + "\nApp ID: " + appid +
            "\nDepot ID: " + depotid
            + "\nManifest ID: " + manifestid
            + "\nPlatform: " + os.platform()
            + "\nPath: " + path
        );
        if (os.platform().includes("linux")) {
            console.log("Using Linux")
            console.log(path)
            try {
                // first check if directory already exists
                if (!fs.existsSync("./depotdownloader")) {
                    fs.mkdirSync("./depotdownloader");
                    console.log("Directory is created.");
                } else {
                    console.log("Directory already exists.");
                }
            } catch (err) {
                console.log(err);
            }
            const url = 'https://github.com/SteamRE/DepotDownloader/releases/download/DepotDownloader_2.4.6/depotdownloader-2.4.6.zip';
            https.get(url,(res) => {
                // Image will be stored at this path
                const path = `${__dirname}/depotdownloader/depotdownloader-2.4.6.zip`;
                const filePath = fs.createWriteStream(path);
                res.pipe(filePath);
                filePath.on('finish',() => {
                    filePath.close();
                    console.log('Download Completed');
                })
            })
            console.log("Downloaded DepotDownloader zip");
        }
    }

</script>
<h2>Steam Depot Downloader</h2>
<form id="theform">
    <div class="form-group">
        <div class="form-group-header">
            <label for="username">Username</label>
        </div>
        <div class="form-group-body">
            <input aria-label="Repository description" class="form-control" id="username" placeholder="Username"
                   type="text"/>
        </div>
        <br>
        <div class="form-group-header">
            <label for="password">Password</label>
        </div>
        <div class="form-group-body">
            <input aria-label="Repository description" class="form-control" id="password" placeholder="Password"
                   type="password"/>
        </div>
        <br>
        <div class="form-group-header">
            <label for="appid">App ID</label>
        </div>
        <div class="form-group-body">
            <input aria-label="Repository description" class="form-control" id="appid" placeholder="App ID"
                   type="text"/>
        </div>
        <br>
        <div class="form-group-header">
            <label for="depotid">Depot ID</label>
        </div>
        <div class="form-group-body">
            <input aria-label="Repository description" class="form-control" id="depotid" placeholder="Depot ID"
                   type="text"/>
        </div>
        <br>
        <div class="form-group-header">
            <label for="manifestid">Manifest ID</label>
        </div>
        <div class="form-group-body">
            <input aria-label="Repository description" class="form-control" id="manifestid" placeholder="Manifest ID"
                   type="text"/>
        </div>
    </div>
</form>
<button class="btn btn-primary" id="download" onclick="submitForm()">
    Download
    <svg class="octicon" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.47 10.78a.75.75 0 001.06 0l3.75-3.75a.75.75 0 00-1.06-1.06L8.75 8.44V1.75a.75.75 0 00-1.5
         0v6.69L4.78 5.97a.75.75 0 00-1.06 1.06l3.75 3.75zM3.75 13a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5z"
              fill-rule="evenodd"></path>
    </svg>
</button>
</body>
</html>